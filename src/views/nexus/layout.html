<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Nexus Portal{% endblock %} | AI-BOS</title>

  <!-- Nexus Portal Styles (self-contained) -->
  <link rel="stylesheet" href="/css/nexus.css">

  <!-- HTMX -->
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>

  {% block head %}{% endblock %}
</head>
<body class="nexus-layout" data-theme="light">

  {% if nexus and nexus.user %}
  <!-- Main Navigation -->
  <header class="nexus-header">
    <div class="nexus-header-left">
      <a href="/nexus/portal" class="nexus-logo">
        <span class="nexus-logo-icon">â¬¡</span>
        <span class="nexus-logo-text">Nexus</span>
      </a>

      <!-- Context Switcher -->
      {% include "nexus/partials/context-badge.html" %}
    </div>

    <nav class="nexus-nav">
      <a href="/nexus/inbox" class="nexus-nav-link {% if activeNav == 'inbox' %}active{% endif %}">
        <span class="nexus-nav-icon">ğŸ“¥</span>
        <span>Inbox</span>
        {% if nexus.unreadCases > 0 %}
        <span class="nexus-badge">{{ nexus.unreadCases }}</span>
        {% endif %}
      </a>

      <a href="/nexus/payments" class="nexus-nav-link {% if activeNav == 'payments' %}active{% endif %}">
        <span class="nexus-nav-icon">ğŸ’°</span>
        <span>Payments</span>
        {% if nexus.unreadPayments > 0 %}
        <span class="nexus-badge critical">{{ nexus.unreadPayments }}</span>
        {% endif %}
      </a>

      <a href="/nexus/relationships" class="nexus-nav-link {% if activeNav == 'relationships' %}active{% endif %}">
        <span class="nexus-nav-icon">ğŸ”—</span>
        <span>Relationships</span>
      </a>
    </nav>

    <div class="nexus-header-right">
      <!-- Notifications Bell -->
      {% include "nexus/partials/notification-bell.html" %}

      <!-- User Menu -->
      <div class="nexus-user-menu">
        <button class="nexus-user-trigger" data-dropdown="user-menu">
          <span class="nexus-user-avatar">{{ nexus.user.display_name | first | upper }}</span>
          <span class="nexus-user-name">{{ nexus.user.display_name }}</span>
          <span class="nexus-user-chevron">â–¼</span>
        </button>

        <div class="nexus-dropdown" id="user-menu">
          <div class="nexus-dropdown-header">
            <strong>{{ nexus.tenant.name }}</strong>
            <small>{{ nexus.user.email }}</small>
          </div>
          <div class="nexus-dropdown-divider"></div>
          <a href="/nexus/settings" class="nexus-dropdown-item">âš™ï¸ Settings</a>
          <a href="/nexus/logout" class="nexus-dropdown-item danger">ğŸšª Sign Out</a>
        </div>
      </div>
    </div>
  </header>
  {% endif %}

  <!-- Main Content -->
  <main class="nexus-main">
    {% block content %}{% endblock %}
  </main>

  <!-- Toast Container -->
  <div id="nexus-toasts" class="nexus-toast-container"></div>

  <!-- Scripts -->
  <script src="/js/nexus/core.js"></script>
  {% if nexus and nexus.user %}
  <script src="/js/nexus/realtime-notifications.js"></script>
  <script>
    // Initialize realtime with user context
    window.nexusRealtime?.init({
      userId: '{{ nexus.user.user_id }}',
      tenantId: '{{ nexus.tenant.tenant_id }}'
    });
  </script>
  {% endif %}

  {% block scripts %}{% endblock %}
</body>
</html>
