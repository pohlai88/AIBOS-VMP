{# Case Thread Partial - Loaded via HTMX #}

{% if messages and messages.length > 0 %}
<div class="nexus-thread">
  {% for message in messages %}
  <div class="nexus-message {% if message.sender_user_id == nexus.userId %}mine{% endif %} {% if message.sender_context == 'client' %}from-client{% else %}from-vendor{% endif %}">
    <div class="nexus-message-avatar">
      <span class="nexus-context-icon {{ message.sender_context }}">
        {% if message.sender_context == 'client' %}â—€{% else %}â–¶{% endif %}
      </span>
    </div>

    <div class="nexus-message-content">
      <div class="nexus-message-header">
        <span class="nexus-message-sender">
          {{ message.sender.display_name or message.sender.email or 'Unknown' }}
        </span>
        <span class="nexus-message-context">
          ({{ message.sender_context | title }})
        </span>
        <span class="nexus-message-time">
          {{ message.created_at | date('MMM D, h:mm A') }}
        </span>
      </div>

      <div class="nexus-message-body">
        {{ message.body | nl2br }}
      </div>

      {% if message.attachments and message.attachments.length > 0 %}
      <div class="nexus-message-attachments">
        {% for file in message.attachments %}
        <a href="{{ file.url }}" class="nexus-attachment" target="_blank">
          ğŸ“ {{ file.filename }}
        </a>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<div class="nexus-empty-state small">
  <span class="nexus-empty-icon">ğŸ’¬</span>
  <h4>No messages yet</h4>
  <p>Send the first message to start the conversation.</p>
</div>
{% endif %}
