{% extends "layout.html" %}
{% block title %}NexusCanon VMP — Console{% endblock %}

{% block content %}
<div class="h-full overflow-y-auto">
  <div class="max-w-[1400px] mx-auto p-6 pb-12">

    <!-- Console Header -->
    <div class="flex flex-wrap justify-between items-end gap-6 mb-8">
      <div class="min-w-0">
        <div class="vmp-label-kicker mb-3">// operational console</div>
        <h1 class="vmp-h2">
          The Connection.<br />The Law.
        </h1>
        <p class="mt-4 vmp-body-small leading-relaxed max-w-[64ch] vmp-muted">
          Self-service truth surface for vendors: resolve exceptions, upload evidence, and track statement/payment
          posture without WhatsApp drift.
        </p>
      </div>

      <!-- Protocol Status -->
      <div class="vmp-panel px-4 py-3 min-w-[320px]">
        <div class="flex items-center gap-4">
          <div class="relative">
            <div class="w-2 h-2 rounded-full vmp-fill-ok"></div>
            <div class="absolute inset-0 rounded-full opacity-60 animate-ping vmp-fill-ok"></div>
          </div>
          <div class="min-w-0">
            <div class="vmp-label-kicker vmp-signal-ok">protocol enforcing</div>
            <div class="vmp-caption vmp-muted mt-1 truncate">3-way match required · evidence gates enabled</div>
          </div>
        </div>
      </div>
    </div>

    <!-- KPI Rail -->
    <div class="grid grid-cols-2 md:grid-cols-4 border-y mb-8 vmp-border-color">
      <div class="p-6 border-r hover:bg-white/[0.02] transition-colors vmp-border-color">
        <div class="vmp-label-kicker mb-2">action required</div>
        <div class="vmp-h3">2</div>
        <div class="vmp-label mt-2">WAITING: YOU</div>
      </div>
      <div class="p-6 border-r hover:bg-white/[0.02] transition-colors vmp-border-color">
        <div class="vmp-label-kicker mb-2">open cases</div>
        <div class="vmp-h3">7</div>
        <div class="vmp-label mt-2">SLA LIVE</div>
      </div>
      <div class="p-6 border-r hover:bg-white/[0.02] transition-colors vmp-border-color">
        <div class="vmp-label-kicker mb-2">statements</div>
        <div class="vmp-h3">1</div>
        <div class="vmp-label mt-2">CURRENT CYCLE</div>
      </div>
      <div class="p-6 hover:bg-white/[0.02] transition-colors">
        <div class="vmp-label-kicker mb-2">payments</div>
        <div class="vmp-h3">3</div>
        <div class="vmp-label mt-2">IN REVIEW</div>
      </div>
    </div>

    <!-- Workspace Grid -->
    <div class="grid lg:grid-cols-[400px_1fr] gap-4 min-h-[640px]">

      <!-- Case Inbox -->
      <section class="vmp-card flex flex-col">
        <header class="vmp-card-header flex justify-between items-start">
          <div>
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-1">case inbox</div>
            <div class="vmp-caption vmp-muted leading-snug max-w-[28ch]">
              Newest updates on top (WhatsApp rhythm).
            </div>
          </div>
          <div class="vmp-label-kicker">sort · updated</div>
        </header>

        <div id="case-inbox" class="flex-1 overflow-y-auto" hx-get="/partials/case-inbox.html" hx-trigger="load"
          hx-indicator="#inbox-loading">
          <div id="inbox-loading" class="htmx-indicator p-4 space-y-3 animate-pulse opacity-60">
            <div class="h-20 rounded-xl vmp-bg-panel"></div>
            <div class="h-20 rounded-xl vmp-bg-panel"></div>
            <div class="h-20 rounded-xl vmp-bg-panel"></div>
          </div>
        </div>
      </section>

      <!-- Truth Panel -->
      <section class="vmp-card flex flex-col relative">
        <header class="vmp-card-header flex justify-between items-start">
          <div>
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-1">workspace</div>
            <div class="vmp-caption vmp-muted leading-snug">Thread · Checklist · Evidence — enforceable chain.</div>
          </div>
          <div class="vmp-tag vmp-tag-mono">
            TRUTH PANEL
          </div>
        </header>

        <div id="case-detail-panel" class="flex-1 relative" aria-live="polite">
          <!-- Empty State -->
          <div class="vmp-empty">
            <div class="font-serif text-6xl italic opacity-35">N</div>
            <div class="vmp-empty-title">SELECT CASE</div>
            <div class="vmp-empty-description">
              Choose a case to reveal the audit chain: messages → checklist → evidence.
            </div>
          </div>

          <!-- Loading overlay when swapping -->
          <div id="detail-loading" class="htmx-indicator absolute inset-0 grid place-items-center vmp-bg-veil">
            <div class="vmp-label-kicker animate-pulse">loading case…</div>
          </div>
        </div>
      </section>

    </div>

  </div>
</div>
{% endblock %}