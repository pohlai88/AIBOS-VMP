<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Activate Access ‚Äî NexusCanon VMP</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/globals.css" />

    <style>
        :root {
            --bg: #060607; --bg2: #050506;
            --accent: hsl(155, 100%, 69%);
            --max-w: 1280px; --r-lg: 22px;
        }

        body {
            margin: 0;
            background: radial-gradient(1000px 800px at 50% -100px, rgba(96, 255, 198, .08), transparent 55%),
                        radial-gradient(800px 600px at 85% 20%, rgba(255, 255, 255, .04), transparent 60%),
                        linear-gradient(to bottom, var(--bg), var(--bg2));
            color: #ededed;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        body:before {
            content: ""; position: fixed; inset: 0; pointer-events: none; opacity: .06; mix-blend-mode: overlay;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.55'/%3E%3C/svg%3E");
        }

        .container { max-width: var(--max-w); margin: 0 auto; padding: 0 2rem; }
        .mono { font-family: 'Inter', monospace; letter-spacing: 0.15em; text-transform: uppercase; }

        .kicker { display: inline-flex; align-items: center; gap: 8px; margin-bottom: 16px; font-size: 11px; letter-spacing: 0.15em; color: rgba(255, 255, 255, .5); text-transform: uppercase; }
        .kicker .dot { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); box-shadow: 0 0 8px var(--accent); animation: pulse 3s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .hero { padding: 96px 0 72px 0; text-align: center; position: relative; }
        .hero h1 { font-size: 24px; font-weight: 500; letter-spacing: -0.02em; margin: 0 0 8px 0; color: #fff; }
        .hero p { color: rgba(255, 255, 255, .5); font-size: 13px; max-width: 600px; margin: 0 auto; line-height: 1.5; }

        /* --- LAYOUTS --- */
        
        /* Layout A: The Split Pane (For Valid Invites) */
        .signup-mirror { max-width: 1000px; margin: 2.75rem auto 0 auto; position: relative; }
        .signup-panes { display: grid; grid-template-columns: 1fr 1fr; gap: 0; min-height: 580px; }
        .signup-seam { position: absolute; left: 50%; top: 14px; bottom: 14px; width: 1px; background: linear-gradient(to bottom, transparent, rgba(255, 255, 255, .22), transparent); box-shadow: 0 0 50px rgba(96, 255, 198, .12); z-index: 3; }
        .signup-pane { padding: 1.75rem; position: relative; }
        .signup-pane-left { border-right: 1px solid rgba(255, 255, 255, .06); }
        .signup-pane-right { border-left: 1px solid rgba(255, 255, 255, .06); }

        /* Layout B: The Single Center Card (For Errors) */
        .error-mirror { max-width: 480px; margin: 4rem auto 0 auto; position: relative; }
        .error-card { padding: 2.5rem; border-radius: var(--r-lg); border: 1px solid rgba(255, 85, 85, .3); background: linear-gradient(to bottom, rgba(255, 85, 85, .05), rgba(0,0,0, .4)); box-shadow: 0 16px 50px rgba(0, 0, 0, .42); text-align: center; }

        /* Shared Panel Styles */
        .pane-content { height: 100%; border-radius: var(--r-lg); border: 1px solid rgba(255, 255, 255, .10); background: linear-gradient(to bottom, rgba(255, 255, 255, .035), rgba(255, 255, 255, .014)); box-shadow: 0 16px 50px rgba(0, 0, 0, .42); padding: 1.75rem; overflow: hidden; position: relative; }
        .pane-inner { position: relative; z-index: 1; height: 100%; display: flex; flex-direction: column; text-align: left; }

        /* Elements */
        .input { width: 100%; background: rgba(0, 0, 0, .3); border: 1px solid rgba(255, 255, 255, .08); padding: 12px 14px; border-radius: 8px; color: #fff; margin-bottom: 16px; transition: all 0.2s ease; }
        .input:focus { border-color: var(--accent); background: rgba(0, 0, 0, .5); outline: none; }
        
        .btn-primary { width: 100%; background: var(--accent); border: none; color: #050506; font-size: 13px; font-weight: 600; text-transform: uppercase; padding: 14px; border-radius: 999px; cursor: pointer; margin-top: 12px; transition: transform .18s ease; display: inline-flex; justify-content: center; align-items: center; text-decoration: none; }
        .btn-primary:hover { transform: translateY(-1px); background: #5fffc4; }

        .trust-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,.08); }
        .trust-label { font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.5; }
        .trust-val { font-family: 'Inter', monospace; font-size: 13px; color: var(--accent); }

        @media (max-width: 980px) { .signup-panes { grid-template-columns: 1fr; } .signup-seam { display: none; } .signup-pane-left { border-right: none; border-bottom: 1px solid rgba(255, 255, 255, .08); } }
    </style>
</head>

<body>
    <header class="hero container">
        <div class="kicker mono">
            <span class="dot" aria-hidden="true"></span>
            NexusCanon VMP ‚Ä¢ ACTIVATION
        </div>

        <h1>Protocol Activation</h1>
        <p>Establish your secure credentials to access the Settlement Vault.</p>

        {% if invite %}
        <div class="signup-mirror">
            <div class="signup-panes">
                <div class="signup-seam" aria-hidden="true"></div>

                <div class="signup-pane signup-pane-left">
                    <div class="pane-content">
                        <div class="pane-inner">
                            <div style="margin-bottom: 24px;">
                                <h2 style="font-size: 24px; font-weight: 500; margin:0;">Identity Scope</h2>
                                <div class="mono" style="font-size: 11px; opacity: 0.5;">TOKEN VERIFIED</div>
                            </div>

                            <div style="display: flex; flex-direction: column; gap: 8px;">
                                <div class="trust-row">
                                    <span class="trust-label">Authorized User</span>
                                    <span class="trust-val" style="color: white;">{{ invite.email }}</span>
                                </div>
                                <div class="trust-row">
                                    <span class="trust-label">Organization</span>
                                    <span class="trust-val">{{ invite.vendor.name or 'Pending Registration' }}</span>
                                </div>
                                <div class="trust-row" style="border-bottom: none;">
                                    <span class="trust-label">Access Scope</span>
                                    <span class="trust-val">
                                        {% if invite.companies|length > 1 %}
                                            {{ invite.companies|length }} ENTITIES
                                        {% else %}
                                            {{ invite.companies[0].name | upper }}
                                        {% endif %}
                                    </span>
                                </div>
                            </div>

                            <div style="margin-top: auto; padding: 16px; border-radius: 14px; border: 1px solid rgba(96, 255, 198, .2); background: rgba(96, 255, 198, .04);">
                                <div style="display:flex; gap:12px; align-items:flex-start;">
                                    <div style="font-size:16px;">üõ°Ô∏è</div>
                                    <div>
                                        <div style="font-size:12px; font-weight:500; color:#fff; margin-bottom:2px;">Role Assignment</div>
                                        <div style="font-size:11px; opacity:0.6; line-height:1.4;">
                                            You are being provisioned as a <strong style="color:var(--accent);">Vendor Administrator</strong>.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="signup-pane signup-pane-right">
                    <div class="pane-content">
                        <div class="pane-inner">
                            <div style="margin-bottom: 20px;">
                                <h2 style="font-size: 24px; font-weight: 500; margin:0;">Credentials</h2>
                                <div class="mono" style="font-size: 11px; opacity: 0.5;">SETUP PASSWORD</div>
                            </div>

                            <form action="/accept" method="POST">
                                <input type="hidden" name="token" value="{{ token }}">
                                
                                <div style="margin-top: 20px; border-top: 1px solid rgba(255,255,255,.08); padding-top: 20px;">
                                    <div style="margin-bottom: 4px;">
                                        <label class="mono" style="font-size: 10px; display:block; margin-bottom: 8px; opacity: 0.5;">Display Name</label>
                                        <input class="input" type="text" name="display_name" 
                                               value="{{ invite.email.split('@')[0] | title }}" required autofocus>
                                    </div>
                                    <div style="margin-bottom: 4px;">
                                        <label class="mono" style="font-size: 10px; display:block; margin-bottom: 8px; opacity: 0.5;">Set Password</label>
                                        <input class="input" type="password" name="password" placeholder="Minimum 8 characters" required minlength="8">
                                    </div>
                                    <div style="margin-bottom: 4px;">
                                        <label class="mono" style="font-size: 10px; display:block; margin-bottom: 8px; opacity: 0.5;">Confirm Password</label>
                                        <input class="input" type="password" name="password_confirm" placeholder="Repeat password" required minlength="8">
                                    </div>
                                    <label style="display:flex; gap:12px; align-items:flex-start; margin: 12px 0 24px 0; cursor:pointer;">
                                        <input type="checkbox" name="terms" required style="margin-top:2px;">
                                        <span style="font-size:12px; opacity:0.6; line-height:1.4;">
                                            I agree to the Data Governance Protocol.
                                        </span>
                                    </label>
                                    <button class="btn-primary" type="submit" id="activate-btn">Activate Account</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% else %}
        <div class="error-mirror">
            <div class="error-card">
                <div style="font-size: 42px; margin-bottom: 16px; opacity: 0.9;">üö´</div>
                <h2 style="font-size: 20px; font-weight: 500; margin-bottom: 8px; color: #ff5555;">Invalid Activation Token</h2>
                <p style="font-size: 14px; opacity: 0.6; margin-bottom: 24px;">
                    This security link has expired or was already used. Please request a new invitation from your administrator.
                </p>
                <a href="/login" class="btn-primary" style="width: auto; padding: 10px 24px;">Return to Login</a>
            </div>
        </div>
        {% endif %}

        <div style="margin-top: 22px; font-size: 12px;">
            <a href="/" style="color: rgba(255,255,255,.5); text-decoration: none;">‚Üê Back to Home</a>
        </div>
    </header>

    <script>
        const btn = document.getElementById('activate-btn');
        if(btn) {
            btn.closest('form').addEventListener('submit', () => {
                btn.disabled = true;
                btn.textContent = 'Activating...';
            });
        }
    </script>
</body>
</html>