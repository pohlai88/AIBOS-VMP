{% extends "layout.html" %}

{% block title %}NexusCanon — Command{% endblock %}

{% block content %}
<style>
    /* Scoped Glass Surface Variables */
    :root {
        --glass-border: rgba(255, 255, 255, 0.08);
        --glass-surface: rgba(255, 255, 255, 0.015);
        --glass-highlight: rgba(255, 255, 255, 0.04);
        --neon-green: #00ff9d;
        --neon-red: #ff3333;
        --neon-amber: #ffaa00;
    }

    /* HUD Card Specifics */
    .hud-card {
        background: linear-gradient(180deg, var(--glass-surface) 0%, transparent 100%);
        border: 1px solid var(--glass-border);
        transition: all 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        position: relative;
        overflow: hidden;
    }
    .hud-card:hover {
        background: var(--glass-highlight);
        border-color: rgba(255,255,255,0.15);
        transform: translateY(-2px);
    }
    
    /* Glow Effects */
    .glow-red::before {
        content:''; position:absolute; top:0; left:0; right:0; height:1px;
        background: linear-gradient(90deg, transparent, var(--neon-red), transparent); opacity:0.6;
    }
    .glow-green::before {
        content:''; position:absolute; top:0; left:0; right:0; height:1px;
        background: linear-gradient(90deg, transparent, var(--neon-green), transparent); opacity:0.6;
    }

    /* Bento Grid Logic */
    .bento-grid {
        display: grid;
        grid-template-columns: repeat(1, 1fr);
        gap: 1.5rem;
    }
    @media (min-width: 1024px) {
        .bento-grid { grid-template-columns: repeat(3, 1fr); grid-template-rows: auto auto; }
        .span-2 { grid-column: span 2; }
        .span-3 { grid-column: span 3; }
    }

    /* Scrollbar Hide for Live Feed */
    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    /* === THE SCANNER PHYSICS === */
    @keyframes scan {
        0% { transform: translateY(-100%); opacity: 0; }
        15% { opacity: 1; }
        100% { transform: translateY(100%); opacity: 0; }
    }

    .scanner-container {
        position: relative;
        overflow: hidden; /* Contains the beam */
    }

    .scanner-beam {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        pointer-events: none;
        z-index: 10;
        
        /* The Beam Gradient: Transparent -> Green Glow -> Transparent */
        background: linear-gradient(
            180deg, 
            transparent 0%, 
            rgba(0, 255, 157, 0.02) 40%, 
            rgba(0, 255, 157, 0.2) 50%, 
            rgba(0, 255, 157, 0.02) 60%, 
            transparent 100%
        );
        
        /* The "Hard Line" at the center of the beam */
        border-bottom: 1px solid rgba(0, 255, 157, 0.1);
        
        /* The Motion */
        animation: scan 4s linear infinite;
    }
</style>

<div class="min-h-full bg-[#050505] text-white p-6 md:p-10">
    <div class="max-w-[1400px] mx-auto space-y-8">

        {% if welcomeMessage %}
        <div class="p-4 border border-[var(--neon-green)]/20 bg-[var(--neon-green)]/5 rounded-lg flex items-center gap-3">
            <span class="text-[var(--neon-green)]">●</span>
            <span class="text-sm text-white/80">{{ welcomeMessage }}</span>
        </div>
        {% endif %}

        {% if error %}
        <div class="p-4 border border-[var(--neon-red)]/20 bg-[var(--neon-red)]/5 rounded-lg flex items-center gap-3">
            <span class="text-[var(--neon-red)]">●</span>
            <span class="text-sm text-white/80">{{ error }}</span>
        </div>
        {% endif %}

        <header class="flex flex-col lg:flex-row justify-between items-start lg:items-end gap-6 border-b border-white/5 pb-6">
            
            <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3 text-xs tracking-widest text-white/40 mb-2 font-mono uppercase">
                    <span>NexusCanon</span>
                    <span class="text-white/20">/</span>
                    <span class="text-[var(--neon-green)]">Global Ops</span>
                </div>
                <h1 class="text-3xl md:text-4xl font-light tracking-tight text-white/90 whitespace-nowrap">
                    Settlement <span class="font-medium text-white">Governance</span>
                </h1>
                <p class="mt-2 text-white/50 text-sm max-w-lg hidden md:block">
                    {% if isIndependent %}
                    Independent Investigator Workspace active. Context separation enforced.
                    {% else %}
                    Orchestrate vendor exceptions and enforce settlement logic.
                    {% endif %}
                </p>
            </div>

            <div class="flex flex-col items-end gap-2 shrink-0">
                
                <div x-data="{ open: false }" class="relative">
                    <a href="/notifications" class="group flex items-center justify-between gap-3 bg-white/[0.03] border border-white/10 hover:border-white/30 hover:bg-white/[0.06] rounded-full px-3 py-1.5 transition-all min-w-[140px]">
                        
                        <div class="flex flex-col items-end flex-1">
                            <span class="text-[9px] uppercase tracking-wider text-white/40 group-hover:text-white/70 font-bold leading-none transition-colors">Signals</span>
                            <span class="text-[9px] font-mono leading-none mt-1 text-[var(--neon-amber)]">
                                Monitoring
                            </span>
                        </div>

                        <div class="relative flex items-center justify-center w-4 h-4">
                            <svg class="w-4 h-4 text-white/40 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                            </svg>
                            <span class="absolute top-0 right-0 flex h-1.5 w-1.5 -mt-0.5 -mr-0.5">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[var(--neon-amber)] opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-[var(--neon-amber)]"></span>
                            </span>
                        </div>
                    </a>
                </div>

                <div class="flex items-center gap-2">
                    <div class="flex items-center justify-between gap-3 bg-white/[0.03] border border-white/10 rounded-full px-3 py-1.5 min-w-[140px]">
                        
                        <div class="flex flex-col items-end flex-1">
                            <span class="text-[9px] uppercase tracking-wider text-[var(--neon-green)] font-bold leading-none">System Online</span>
                            <span class="text-[9px] text-white/40 font-mono leading-none mt-1 truncate max-w-[80px]">
                                {% if user %}{{ user.email }}{% else %}GUEST{% endif %}
                            </span>
                        </div>

                        <div class="relative flex h-1.5 w-1.5 mx-1"> <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-[var(--neon-green)] opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-1.5 w-1.5 bg-[var(--neon-green)]"></span>
                        </div>
                    </div>

                    {% if user %}
                    <form action="/logout" method="POST" class="shrink-0">
                        <button type="submit" 
                                class="flex items-center justify-center w-10 h-10 rounded-full bg-white/[0.03] border border-white/10 hover:border-[#ff3333]/30 hover:bg-[#ff3333]/10 text-white/40 hover:text-[#ff3333] transition-all"
                                title="Sign Out">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </button>
                    </form>
                    {% endif %}
                </div>

            </div>
        </header>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            
            <a href="/case-dashboard?posture=action" class="hud-card rounded-xl p-5 group {% if actionCount and actionCount > 0 %}glow-red{% endif %}">
                <div class="text-[10px] uppercase tracking-widest text-white/40 mb-3 group-hover:text-white/60 transition-colors">Action Required</div>
                <div class="text-4xl font-light tracking-tighter text-white mb-1 group-hover:scale-105 transition-transform origin-left">
                    {{ actionCount or 0 }}
                </div>
                <div class="text-xs text-[#ff3333] flex items-center gap-2">
                    {% if actionCount > 0 %}
                    <span>● WAITING ON YOU</span>
                    {% else %}
                    <span class="text-white/20">All Clear</span>
                    {% endif %}
                </div>
            </a>

            <a href="/case-dashboard?posture=open" class="hud-card rounded-xl p-5 group">
                <div class="text-[10px] uppercase tracking-widest text-white/40 mb-3 group-hover:text-white/60 transition-colors">Active Cases</div>
                <div class="text-4xl font-light tracking-tighter text-white mb-1 group-hover:scale-105 transition-transform origin-left">
                    {{ openCount or 0 }}
                </div>
                <div class="text-xs text-[var(--neon-green)] opacity-80">
                    SLA MONITORING ACTIVE
                </div>
            </a>

            <a href="/case-dashboard?posture=soa" class="hud-card rounded-xl p-5 group">
                <div class="text-[10px] uppercase tracking-widest text-white/40 mb-3 group-hover:text-white/60 transition-colors">Statements</div>
                <div class="text-4xl font-light tracking-tighter text-white mb-1 group-hover:scale-105 transition-transform origin-left">
                    {{ soaCount or 0 }}
                </div>
                <div class="text-xs text-white/30">
                    CURRENT CYCLE
                </div>
            </a>

            <a href="/case-dashboard?posture=paid" class="hud-card rounded-xl p-5 group">
                <div class="text-[10px] uppercase tracking-widest text-white/40 mb-3 group-hover:text-white/60 transition-colors">Settled</div>
                <div class="text-4xl font-light tracking-tighter text-white mb-1 group-hover:scale-105 transition-transform origin-left">
                    {{ paidCount or 0 }}
                </div>
                <div class="text-xs text-white/30">
                    LAST 30 DAYS
                </div>
            </a>
        </div>

        <div class="bento-grid">
            
            <div class="span-2 hud-card rounded-2xl p-6 flex flex-col justify-between group">
                <div class="relative z-10">
                    <h3 class="text-lg font-medium text-white mb-1">Initiate Protocol</h3>
                    <p class="text-sm text-white/50 max-w-md">Open a new settlement case, log a dispute, or upload unrequested evidence.</p>
                </div>
                
                <div class="grid grid-cols-2 gap-3 mt-8 relative z-10">
                    <a href="/new-case" class="flex items-center justify-center gap-3 bg-white text-black font-semibold py-3 px-4 rounded-lg hover:bg-white/90 transition-colors">
                        <span class="text-lg">+</span> Create Case
                    </a>
                    <a href="/invoices" class="flex items-center justify-center gap-3 bg-white/5 border border-white/10 text-white font-medium py-3 px-4 rounded-lg hover:bg-white/10 transition-colors">
                        <span>#</span> View Invoices
                    </a>
                </div>

                <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-bl from-white/5 to-transparent rounded-full blur-3xl -mr-16 -mt-16 pointer-events-none"></div>
            </div>

            <a href="/scanner" class="hud-card rounded-2xl p-0 flex flex-col h-full scanner-container group hover:border-[var(--neon-green)]/30 transition-colors">
                
                <div class="scanner-beam"></div>

                <div class="p-5 pb-3 border-b border-white/5 flex justify-between items-center bg-white/[0.01] relative z-20">
                    <div class="flex items-center gap-2">
                        <span class="w-1.5 h-1.5 rounded-full bg-[var(--neon-green)] animate-pulse"></span>
                        <span class="text-xs font-medium text-white tracking-wide">LIVE FEED</span>
                    </div>
                    <span class="text-[9px] font-mono text-white/30">TRACE_LOG</span>
                </div>

                <div class="flex-1 overflow-y-auto p-0 scrollbar-hide relative z-20">
                    
                    <div class="group/item flex gap-4 p-4 border-b border-white/5 hover:bg-white/[0.02] transition-colors cursor-pointer">
                        <div class="mt-1">
                            <div class="w-2 h-2 rounded-full border border-[var(--neon-green)] bg-[var(--neon-green)]/20 shadow-[0_0_8px_var(--neon-green)]"></div>
                            <div class="w-px h-full bg-white/5 mx-auto mt-2 group-last/item:hidden"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono text-white/30">10:42 AM</span>
                                <span class="text-[10px] font-bold text-[var(--neon-green)] border border-[var(--neon-green)]/20 px-1.5 rounded bg-[var(--neon-green)]/5">SETTLED</span>
                            </div>
                            <p class="text-sm text-white/90">Invoice <span class="font-mono text-white/50">INV-2024-001</span> marked as paid.</p>
                        </div>
                    </div>

                    <div class="group/item flex gap-4 p-4 border-b border-white/5 hover:bg-white/[0.02] transition-colors cursor-pointer">
                        <div class="mt-1">
                            <div class="w-2 h-2 rounded-full border border-[var(--neon-amber)] bg-[var(--neon-amber)]/20"></div>
                            <div class="w-px h-full bg-white/5 mx-auto mt-2 group-last/item:hidden"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono text-white/30">09:15 AM</span>
                                <span class="text-[10px] font-bold text-[var(--neon-amber)] border border-[var(--neon-amber)]/20 px-1.5 rounded bg-[var(--neon-amber)]/5">ALERT</span>
                            </div>
                            <p class="text-sm text-white/90">Exception raised on <span class="font-mono text-white/50">PO-9921</span>.</p>
                            <p class="text-xs text-white/40 mt-1">"Quantity mismatch detected by Warehouse."</p>
                        </div>
                    </div>

                    <div class="group/item flex gap-4 p-4 border-b border-white/5 hover:bg-white/[0.02] transition-colors cursor-pointer">
                        <div class="mt-1">
                            <div class="w-2 h-2 rounded-full border border-[var(--neon-green)] bg-[var(--neon-green)]/20"></div>
                            <div class="w-px h-full bg-white/5 mx-auto mt-2 group-last/item:hidden"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono text-white/30">08:30 AM</span>
                                <span class="text-[10px] font-bold text-[var(--neon-green)] border border-[var(--neon-green)]/20 px-1.5 rounded bg-[var(--neon-green)]/5">PAYMENT</span>
                            </div>
                            <p class="text-sm text-white/90">Remittance <span class="font-mono text-white/50">REM-2024-045</span> processed.</p>
                            <p class="text-xs text-white/40 mt-1">Amount: $12,450.00 credited to account.</p>
                        </div>
                    </div>

                    <div class="group/item flex gap-4 p-4 border-b border-white/5 hover:bg-white/[0.02] transition-colors cursor-pointer">
                        <div class="mt-1">
                            <div class="w-2 h-2 rounded-full border border-white/30 bg-white/10"></div>
                            <div class="w-px h-full bg-white/5 mx-auto mt-2 group-last/item:hidden"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono text-white/30">YESTERDAY</span>
                                <span class="text-[10px] font-bold text-white/40 border border-white/10 px-1.5 rounded">SYSTEM</span>
                            </div>
                            <p class="text-sm text-white/70">Monthly Statement generated.</p>
                        </div>
                    </div>

                    <div class="group/item flex gap-4 p-4 hover:bg-white/[0.02] transition-colors cursor-pointer">
                        <div class="mt-1">
                            <div class="w-2 h-2 rounded-full border border-white/30 bg-white/10"></div>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <span class="text-[10px] font-mono text-white/30">2 DAYS AGO</span>
                                <span class="text-[10px] font-bold text-white/40 border border-white/10 px-1.5 rounded">UPDATE</span>
                            </div>
                            <p class="text-sm text-white/70">Profile information updated.</p>
                        </div>
                    </div>

                </div>

                <div class="absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-[#050505] to-transparent pointer-events-none z-20"></div>
            </a>

            <div class="span-3 hud-card rounded-2xl p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-sm font-medium text-white/70 uppercase tracking-widest">Navigation Vectors</h3>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <a href="/case-dashboard" class="p-4 rounded-lg bg-white/[0.02] border border-white/5 hover:bg-white/[0.05] hover:border-white/10 transition-all group">
                        <div class="text-[var(--neon-green)] mb-2 opacity-50 group-hover:opacity-100">●</div>
                        <div class="text-sm font-medium text-white">Case Inbox</div>
                        <div class="text-xs text-white/40 mt-1">Manage active disputes</div>
                    </a>

                    <a href="/payments" class="p-4 rounded-lg bg-white/[0.02] border border-white/5 hover:bg-white/[0.05] hover:border-white/10 transition-all group">
                        <div class="text-white mb-2 opacity-30 group-hover:opacity-100">$</div>
                        <div class="text-sm font-medium text-white">Payments</div>
                        <div class="text-xs text-white/40 mt-1">History & Remittance</div>
                    </a>

                    <a href="/profile" class="p-4 rounded-lg bg-white/[0.02] border border-white/5 hover:bg-white/[0.05] hover:border-white/10 transition-all group">
                        <div class="text-white mb-2 opacity-30 group-hover:opacity-100">⚙</div>
                        <div class="text-sm font-medium text-white">Config</div>
                        <div class="text-xs text-white/40 mt-1">Bank & Tax Data</div>
                    </a>

                    {% if isIndependent %}
                    <a href="/profile" class="p-4 rounded-lg bg-[var(--neon-amber)]/10 border border-[var(--neon-amber)]/20 hover:bg-[var(--neon-amber)]/20 transition-all group">
                        <div class="text-[var(--neon-amber)] mb-2 opacity-80">★</div>
                        <div class="text-sm font-medium text-[var(--neon-amber)]">Investigator</div>
                        <div class="text-xs text-[var(--neon-amber)]/60 mt-1">Mode Active</div>
                    </a>
                    {% else %}
                    <a href="/help" class="p-4 rounded-lg bg-white/[0.02] border border-white/5 hover:bg-white/[0.05] hover:border-white/10 transition-all group">
                        <div class="text-white mb-2 opacity-30 group-hover:opacity-100">?</div>
                        <div class="text-sm font-medium text-white">Support</div>
                        <div class="text-xs text-white/40 mt-1">Escalation path</div>
                    </a>
                    {% endif %}
                </div>
            </div>

        </div>

    </div>
</div>
{% endblock %}