{% extends "layout.html" %}
{% block title %}NexusCanon VMP — Enterprise Vendor Management Portal{% endblock %}

{% block head %}
  {{ super() }}
  <!-- NOIR Login Theme (Design Layer - Marketing/Creative) -->
  <link rel="stylesheet" href="/login-noir-theme.css" />
  <style>
    /* Hide sidebar on login page */
    .vmp-sidebar { display: none !important; }
    main { margin-left: 0 !important; }
  </style>
{% endblock %}

{% block content %}
<main class="vmp-login vmp-login--vault vmp-login--noir" x-data="{ 
  email: '', 
  password: '',
  mode: 'login',
  focused: false,
  canSubmit() {
    return this.email.length > 5 && this.password.length > 5;
  }
}">

    <div class="vmp-login__bg" aria-hidden="true"></div>
    <div class="noir-grid-overlay" aria-hidden="true"></div>

    <div class="vmp-login__wrap vmp-login__wrap--noir">

        <div class="vmp-login__hero vmp-login__hero--noir">
            <div class="vmp-brand vmp-brand--noir">
                <div class="vmp-brand__mark vmp-brand__mark--noir">
                    <svg width="20" height="20" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <pattern id="gridPatternNoir" x="0" y="0" width="4" height="4" patternUnits="userSpaceOnUse">
                                <path d="M 4 0 L 0 0 0 4" fill="none" stroke="rgba(237,237,237,0.04)" stroke-width="0.5"/>
                            </pattern>
                            <linearGradient id="bgGradNoir" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="rgba(255,255,255,0.03)" />
                                <stop offset="100%" stop-color="rgba(255,255,255,0.01)" />
                            </linearGradient>
                        </defs>
                        <rect width="24" height="24" fill="url(#bgGradNoir)" />
                        <rect width="24" height="24" fill="url(#gridPatternNoir)" />
                        <path d="M 12 20 L 4 4 L 20 4 Z" fill="none" stroke="rgba(237,237,237,0.25)" stroke-width="1" stroke-linejoin="miter"/>
                        <path d="M 12 16 L 6.5 6 L 17.5 6 Z" fill="none" stroke="rgba(237,237,237,0.45)" stroke-width="1.2" stroke-linejoin="miter"/>
                        <path d="M 12 12 L 8 6 L 16 6 Z" fill="rgba(237,237,237,0.85)" stroke="rgba(237,237,237,1)" stroke-width="1.2" stroke-linejoin="miter"/>
                        <line x1="12" y1="12" x2="12" y2="20" stroke="rgba(237,237,237,0.35)" stroke-width="0.8" stroke-linecap="round"/>
                        <line x1="8" y1="6" x2="4" y2="4" stroke="rgba(237,237,237,0.25)" stroke-width="0.6" stroke-linecap="round"/>
                        <line x1="16" y1="6" x2="20" y2="4" stroke="rgba(237,237,237,0.25)" stroke-width="0.6" stroke-linecap="round"/>
                        <circle cx="12" cy="12" r="1" fill="rgba(237,237,237,1)"/>
                        <circle cx="12" cy="16" r="0.6" fill="rgba(237,237,237,0.65)"/>
                        <circle cx="12" cy="20" r="0.6" fill="rgba(237,237,237,0.45)"/>
                        <circle cx="8" cy="6" r="0.5" fill="rgba(237,237,237,0.75)"/>
                        <circle cx="16" cy="6" r="0.5" fill="rgba(237,237,237,0.75)"/>
                    </svg>
                </div>
                <div class="vmp-brand__stack">
                    <div class="vmp-brand__name vmp-brand__name--noir">NexusCanon</div>
                    <div class="vmp-brand__sub vmp-brand__sub--noir font-mono">ENTERPRISE VENDOR MANAGEMENT · PAYMENT GOVERNANCE</div>
                </div>
            </div>

            <div class="vmp-login__content--noir">
                <div class="vmp-chip vmp-chip--mono vmp-chip--noir"><span aria-hidden="true"></span>ENTERPRISE ACCESS · CONTROLLED WORKFLOW</div>
                <h1 class="vmp-login__title vmp-login__title--noir font-serif display-shock">
                    Governed<br />
                    <span class="vmp-title-italic">Settlement.</span>
                </h1>
                <p class="vmp-login__lead vmp-login__lead--noir">
                    A comprehensive, audit-ready platform for enterprise vendor claims and payment exception management. 
                    Structured evidence submission, accountable decision-making, and end-to-end settlement visibility 
                    with full transparency and governance controls.
                </p>

                <div class="mt-5 space-y-2 vmp-caption vmp-muted">
                    <div><strong>01</strong> — Authenticate (corporate identity or enterprise SSO) to access your vendor case management workspace.</div>
                    <div><strong>02</strong> — Submit complete evidence documentation (purchase order, goods receipt, invoice) through structured workflows.</div>
                    <div><strong>03</strong> — Monitor disposition status (under review → approved → payment released / settled) with real-time visibility.</div>
                </div>
            </div>

            <div class="vmp-ritual vmp-ritual--noir">
                <div class="vmp-ritual__row">
                    <span class="vmp-ritual__label font-mono">Governance Controls</span>
                    <span class="vmp-ritual__value">Evidence gates · Three-way verification · Role-based approval workflows</span>
                </div>
                <div class="vmp-ritual__row vmp-ritual__row--border">
                    <span class="vmp-ritual__label font-mono">Transparency & Assurance</span>
                    <span class="vmp-ritual__value vmp-ritual__value--status">
                        <span class="vmp-status-indicator"></span>
                        Tamper-evident audit log · Complete transaction history · Dispute-ready documentation
                    </span>
                </div>
            </div>
        </div>

        <div class="vmp-login__panel vmp-login__panel--noir">

            <div class="vmp-login__card vmp-login__card--noir transition-all duration-500"
                :class="{ 'is-ready': canSubmit() }">

                <div class="vmp-login__cardhead vmp-login__cardhead--noir">
                    <div class="vmp-status vmp-status--noir">
                        <div class="vmp-status__dot" 
                             :data-state="canSubmit() ? 'ok' : (email.length > 5 ? 'warn' : '')"></div>
                        <span class="vmp-status__text" x-text="canSubmit()
                ? 'GATE CLEARED · SESSION READY'
                : (email.length > 5 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) ? 'IDENTITY VERIFIED · CREDENTIAL REQUIRED'
                : (email.length > 0 ? 'IDENTITY GATE · ACTION REQUIRED' : 'IDENTITY GATE · STANDBY'))">
                        </span>
                    </div>
                    <ul class="vmp-steps vmp-steps--noir font-mono">
                        <li class="vmp-step" 
                            :class="{ 'is-on': mode === 'login' && email.length > 5 && password.length >= 8, 'is-done': email.length > 5 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) }">01</li>
                        <li class="vmp-step" 
                            :class="{ 'is-on': mode === 'sso' }">02</li>
                        <li class="vmp-step" 
                            :class="{ 'is-on': mode === 'rec' }">03</li>
                    </ul>
                </div>

                <form class="vmp-login__form vmp-login__form--noir" method="POST" action="/login">

                    <div class="vmp-segment vmp-segment--noir">
                        <button type="button" class="vmp-segment__btn" :class="{ 'is-selected': mode === 'login' }"
                            @click="mode = 'login'">EMAIL LOGIN</button>
                        <button type="button" class="vmp-segment__btn" :class="{ 'is-selected': mode === 'sso' }"
                            @click="mode = 'sso'">ENTERPRISE SSO</button>
                        <button type="button" class="vmp-segment__btn" :class="{ 'is-selected': mode === 'rec' }"
                            @click="mode = 'rec'">SUPPORT</button>
                    </div>

                    <div class="vmp-form-fields" x-show="mode === 'login'" x-transition>
                        <div class="vmp-field vmp-field--noir" 
                             :data-state="email.length > 5 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) ? 'ok' : (email.length > 0 ? 'danger' : '')">
                            <div class="vmp-field__top">
                                <label class="vmp-label font-mono" style="font-size: 11px; letter-spacing: 0.22em; text-transform: uppercase; color: rgba(255, 255, 255, 0.58); font-family: 'JetBrains Mono', ui-monospace, monospace;">Corporate Identity</label>
                            </div>
                            <input type="email" name="email" x-model="email" class="vmp-input vmp-input--noir"
                                placeholder="name@company.com" required autocomplete="username" inputmode="email">
                            <div class="vmp-field__hint" x-show="email.length > 0">
                                <div class="vmp-field__status" 
                                     :class="email.length > 5 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) ? 'ok' : 'bad'">
                                    <span class="mini" aria-hidden="true"></span>
                                    <span x-text="email.length > 5 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email) ? 'VERIFIED' : 'UNVERIFIED'"></span>
                                </div>
                                <div style="font-size: 12px; color: rgba(255, 255, 255, 0.46);">Use the mailbox provisioned for settlement cases.</div>
                            </div>
                        </div>

                        <div class="vmp-field vmp-field--noir" 
                             :data-state="password.length >= 8 ? 'ok' : (password.length > 0 ? 'danger' : '')">
                            <div class="vmp-field__top">
                                <label class="vmp-label font-mono" style="font-size: 11px; letter-spacing: 0.22em; text-transform: uppercase; color: rgba(255, 255, 255, 0.58); font-family: 'JetBrains Mono', ui-monospace, monospace;">Access Credential</label>
                                <button type="button" class="vmp-linkbtn">Request Access</button>
                            </div>
                            <input type="password" name="password" x-model="password"
                                class="vmp-input vmp-input--noir vmp-input--password" placeholder="••••••••" required
                                autocomplete="current-password" minlength="8">
                            <div class="vmp-field__hint" x-show="password.length > 0">
                                <div class="vmp-field__status" 
                                     :class="password.length >= 8 ? 'ok' : 'bad'">
                                    <span class="mini" aria-hidden="true"></span>
                                    <span x-text="password.length >= 8 ? 'READY' : 'LOCKED'"></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="vmp-form-sso" x-show="mode === 'sso'" x-cloak>
                        <button type="button" class="vmp-btn vmp-btn-oauth vmp-btn-oauth--noir">
                            <span>Continue with Enterprise SSO</span>
                            <svg class="vmp-btn-oauth-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                            </svg>
                        </button>
                        <button type="button" class="vmp-btn vmp-btn-oauth vmp-btn-oauth--noir">
                            <span>Continue with Microsoft Entra ID</span>
                            <svg class="vmp-btn-oauth-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                            </svg>
                        </button>
                        <button type="button" class="vmp-btn vmp-btn-oauth vmp-btn-oauth--noir">
                            <span>Continue with Google Workspace</span>
                            <svg class="vmp-btn-oauth-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
                            </svg>
                        </button>
                        <div class="vmp-panel p-3 mt-4">
                            <div class="vmp-caption vmp-muted">
                                <strong class="vmp-text">Note:</strong> Enterprise SSO is recommended for internal finance teams. 
                                Vendor partners should use Email access unless explicitly provisioned for SSO authentication.
                            </div>
                        </div>
                    </div>

                    <div class="vmp-form-recover" x-show="mode === 'rec'" x-cloak>
                        <div class="vmp-panel p-4">
                            <div class="vmp-body-small mb-2"><strong>Access & Provisioning</strong></div>
                            <div class="vmp-caption vmp-muted mb-4">
                                If you require access to the vendor management portal, please request provisioning from 
                                your organization's Accounts Payable Operations team. Your access request will be logged 
                                as a formal case and processed through our governance workflow.
                            </div>
                            <div class="vmp-body-small mb-2"><strong>Evidence Standards</strong></div>
                            <div class="vmp-caption vmp-muted mb-4">
                                All submissions require a complete evidence documentation pack. Incomplete or insufficient 
                                documentation will remain in review status until all required artifacts are provided and verified.
                            </div>
                            <div class="vmp-body-small mb-2"><strong>Contact</strong></div>
                            <div class="vmp-caption vmp-muted mb-4">
                                Email: <a href="mailto:ops@nexuscanon.com" class="vmp-link">ops@nexuscanon.com</a><br/>
                                Please include: supplier name, billing reference number, and company code in your request.
                            </div>
                            <button type="button" class="vmp-btn vmp-btn-outline w-full">Request Access</button>
                        </div>
                    </div>

                    <div class="vmp-form-footer vmp-form-footer--noir">
                        <div class="vmp-row vmp-row--noir">
                            <label class="vmp-check vmp-check--noir">
                                <input type="checkbox" class="vmp-check__box">
                                <span class="vmp-check__text">Remember Identity</span>
                            </label>
                        </div>

                        {% if error %}
                        <div class="vmp-panel p-3 mb-4 border vmp-border-color"
                            style="border-color: var(--vmp-danger);">
                            <div class="vmp-caption vmp-text-danger">{{ error }}</div>
                        </div>
                        {% endif %}

                        <button type="submit" class="vmp-btn vmp-btn-brand vmp-btn-wide vmp-btn-lg vmp-btn--noir"
                            :disabled="!canSubmit()">
                            <span>INITIATE SESSION</span>
                            <svg class="vmp-btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M17 8l4 4m0 0l-4 4m4-4H3">
                                </path>
                            </svg>
                        </button>
                    </div>

                </form>
            </div>

            <div class="vmp-login__footerline vmp-login__footerline--noir">
                <p class="font-mono">
                    Protected by NexusCanon VMP · Enterprise Vendor Management Platform<br>
                    Authorized Personnel Only · All actions are recorded for audit compliance
                </p>
            </div>
        </div>
    </div>
</main>
{% endblock %}