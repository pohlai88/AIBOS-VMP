<div class="vmp-modal-overlay" 
     id="new-case-modal"
     hx-target="this" 
     hx-swap="outerHTML" 
     hx-on:click="if(event.target === this) this.remove()">

    <div class="vmp-modal shadow-2xl animate-in fade-in zoom-in duration-200">
        
        <div class="vmp-modal-header flex justify-between items-center">
            <div>
                <h3 class="vmp-h4 leading-none">Create Case</h3>
                <p class="vmp-caption opacity-60 mt-1">Initialize a new dispute or inquiry protocol.</p>
            </div>
            <button class="vmp-modal-close" onclick="document.getElementById('new-case-modal').remove()">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>

        <form hx-post="/cases" 
              hx-indicator="#create-loading"
              class="flex flex-col flex-1 overflow-hidden">
            
            <div class="vmp-modal-body space-y-5">
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="vmp-label mb-2 block opacity-70">Protocol Type</label>
                        <select name="case_type" class="vmp-select w-full" required>
                            <option value="dispute">Invoice Dispute</option>
                            <option value="inquiry">General Inquiry</option>
                            <option value="compliance">Compliance Check</option>
                        </select>
                    </div>
                    <div>
                        <label class="vmp-label mb-2 block opacity-70">Priority</label>
                        <select name="priority" class="vmp-select w-full">
                            <option value="normal">Normal</option>
                            <option value="high">High (SLA &lt; 48h)</option>
                            <option value="critical">Critical (Immediate)</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="vmp-label mb-2 block opacity-70">Subject</label>
                    <input type="text" 
                           name="subject" 
                           class="vmp-input w-full" 
                           placeholder="e.g., Price variance on PO-4921" 
                           required>
                </div>

                <div>
                    <label class="vmp-label mb-2 block opacity-70">Related Entity (Optional)</label>
                    <div class="relative">
                        <svg class="absolute left-3 top-3 w-4 h-4 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        <input type="text" 
                               name="entity_search" 
                               class="vmp-input pl-9 w-full" 
                               placeholder="Search Invoice #, PO #, or Vendor Name..."
                               hx-get="/api/search/entities"
                               hx-trigger="keyup changed delay:500ms"
                               hx-target="#entity-results">
                    </div>
                    <div id="entity-results" class="mt-2 empty:hidden"></div>
                </div>

                <div>
                    <label class="vmp-label mb-2 block opacity-70">Initial Statement</label>
                    <textarea name="description" 
                              class="vmp-textarea w-full" 
                              rows="4" 
                              placeholder="Describe the issue. This will be the first message in the case thread." 
                              required></textarea>
                </div>
            </div>

            <div class="vmp-modal-footer">
                <button type="button" 
                        class="vmp-btn vmp-btn-ghost" 
                        onclick="document.getElementById('new-case-modal').remove()">
                    Cancel
                </button>
                <button type="submit" class="vmp-btn vmp-btn-primary min-w-[120px]">
                    <span class="vmp-label text-[var(--vmp-bg)]">Initialize Protocol</span>
                </button>
            </div>
            
            <div id="create-loading" class="htmx-indicator absolute inset-0 bg-[var(--vmp-bg)]/80 backdrop-blur-sm flex items-center justify-center z-50">
                <div class="flex flex-col items-center gap-3">
                    <div class="vmp-spinner w-8 h-8 border-2"></div>
                    <div class="vmp-label animate-pulse">Creating Case...</div>
                </div>
            </div>
        </form>
    </div>
</div>