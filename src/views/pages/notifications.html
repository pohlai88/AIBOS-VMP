{% extends "layout.html" %}
{% block title %}Notifications — NexusCanon VMP{% endblock %}

{% block content %}
<div class="h-full flex flex-col">
    <div class="vmp-container py-8 max-w-4xl mx-auto shrink-0 w-full">
        
        <header class="flex items-center justify-between mb-8">
            <div>
                <h1 class="vmp-h1 leading-none mb-2">Notifications</h1>
                <p class="vmp-body opacity-60">
                    {% if unreadCount and unreadCount > 0 %}
                        You have {{ unreadCount }} unread alert{{ 's' if unreadCount != 1 else '' }}.
                    {% else %}
                        You are all caught up.
                    {% endif %}
                </p>
            </div>
            {% if unreadCount and unreadCount > 0 %}
            <form method="POST" action="/notifications/mark-all-read">
                <button type="submit" class="vmp-btn vmp-btn-ghost vmp-btn-sm">
                    Mark All Read
                </button>
            </form>
            {% endif %}
        </header>

        <div class="space-y-3">
            {% if notifications and notifications|length > 0 %}
                {% for notification in notifications %}
                <div class="vmp-panel p-4 border transition-colors hover:bg-[var(--vmp-panel)] relative
                            {{ 'border-l-4' if not notification.is_read else 'opacity-80' }}"
                     style="border-color: {{ 'var(--vmp-brand)' if not notification.is_read else 'var(--vmp-border)' }};">
                    
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <h3 class="vmp-body-small font-medium {{ 'text-[var(--vmp-text)]' if not notification.is_read else 'opacity-80' }}">
                                    {{ notification.title }}
                                </h3>
                                {% if not notification.is_read %}
                                <span class="vmp-badge text-[9px] vmp-badge-brand">NEW</span>
                                {% endif %}
                            </div>
                            
                            {% if notification.body %}
                            <p class="vmp-caption opacity-60 mb-3 leading-relaxed max-w-2xl">{{ notification.body }}</p>
                            {% endif %}
                            
                            <div class="flex items-center gap-4">
                                <span class="vmp-caption opacity-40 text-[10px]">
                                    {{ notification.created_at | date('%b %d, %H:%M') if notification.created_at else '—' }}
                                </span>
                                
                                {% if notification.payment_id %}
                                <a href="/payments/{{ notification.payment_id }}" class="vmp-link text-xs flex items-center gap-1">
                                    View Payment <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                </a>
                                {% endif %}
                                {% if notification.case_id %}
                                <a href="/cases/{{ notification.case_id }}" class="vmp-link text-xs flex items-center gap-1">
                                    View Case <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                                </a>
                                {% endif %}
                            </div>
                        </div>

                        {% if not notification.is_read %}
                        <form method="POST" action="/notifications/{{ notification.id }}/read" class="shrink-0">
                            <button type="submit" class="vmp-btn vmp-btn-ghost p-2 rounded-full" title="Mark as read">
                                <div class="w-2 h-2 rounded-full bg-[var(--vmp-brand)]"></div>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="vmp-empty py-16 text-center">
                    <div class="vmp-empty-title">SILENCE</div>
                    <div class="vmp-empty-description">No alerts to display.</div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}