{% extends "layout.html" %}
{% block title %}Access Requests â€” NexusCanon VMP{% endblock %}

{% block content %}
<div class="h-full overflow-y-auto">
    <div class="vmp-container max-w-7xl mx-auto p-6">
        <header class="mb-6">
            <h1 class="vmp-h1 mb-2">Access Requests</h1>
            <p class="vmp-body vmp-muted">Review and process vendor access requests from the sign-up form</p>
        </header>

        <!-- Status Filter -->
        <div class="mb-6 flex gap-2">
            <a href="/ops/access-requests" 
               class="vmp-action-button vmp-action-button-ghost {% if not statusFilter %}vmp-action-button-active{% endif %}">
                All
            </a>
            <a href="/ops/access-requests?status=pending" 
               class="vmp-action-button vmp-action-button-ghost {% if statusFilter == 'pending' %}vmp-action-button-active{% endif %}">
                Pending
            </a>
            <a href="/ops/access-requests?status=approved" 
               class="vmp-action-button vmp-action-button-ghost {% if statusFilter == 'approved' %}vmp-action-button-active{% endif %}">
                Approved
            </a>
            <a href="/ops/access-requests?status=invited" 
               class="vmp-action-button vmp-action-button-ghost {% if statusFilter == 'invited' %}vmp-action-button-active{% endif %}">
                Invited
            </a>
            <a href="/ops/access-requests?status=rejected" 
               class="vmp-action-button vmp-action-button-ghost {% if statusFilter == 'rejected' %}vmp-action-button-active{% endif %}">
                Rejected
            </a>
        </div>

        <!-- Requests List -->
        <div class="space-y-4">
            {% if requests and requests|length > 0 %}
                {% for request in requests %}
                <div class="vmp-panel p-6 border vmp-border-color">
                    <div class="flex items-start justify-between gap-4 mb-4">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="vmp-h3">{{ request.name }}</h3>
                                <span class="vmp-tag {% if request.status == 'pending' %}vmp-tag-warn{% elif request.status == 'approved' or request.status == 'invited' %}vmp-tag-ok{% else %}vmp-tag-danger{% endif %}">
                                    {{ request.status|upper }}
                                </span>
                            </div>
                            <div class="vmp-body-small vmp-muted mb-1">
                                <strong>Email:</strong> {{ request.email }}
                            </div>
                            <div class="vmp-body-small vmp-muted mb-1">
                                <strong>Company:</strong> {{ request.company }}
                            </div>
                            {% if request.customer_company %}
                            <div class="vmp-body-small vmp-muted mb-1">
                                <strong>Customer Company:</strong> {{ request.customer_company }}
                            </div>
                            {% endif %}
                            {% if request.message %}
                            <div class="vmp-panel p-3 mt-3 vmp-bg-panel">
                                <div class="vmp-label-kicker mb-1">Message</div>
                                <div class="vmp-body-small">{{ request.message }}</div>
                            </div>
                            {% endif %}
                            <div class="vmp-caption vmp-muted mt-3">
                                Submitted: {{ request.created_at|date('%Y-%m-%d %H:%M') }}
                            </div>
                            {% if request.reviewed_at %}
                            <div class="vmp-caption vmp-muted">
                                Reviewed: {{ request.reviewed_at|date('%Y-%m-%d %H:%M') }}
                            </div>
                            {% endif %}
                            {% if request.review_notes %}
                            <div class="vmp-panel p-3 mt-3 vmp-bg-panel">
                                <div class="vmp-label-kicker mb-1">Review Notes</div>
                                <div class="vmp-body-small">{{ request.review_notes }}</div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="shrink-0">
                            {% if request.status == 'pending' %}
                            <div class="flex flex-col gap-2">
                                <form hx-post="/ops/access-requests/{{ request.id }}/status" 
                                      hx-target="closest .vmp-panel" 
                                      hx-swap="outerHTML"
                                      class="inline">
                                    <input type="hidden" name="status" value="approved">
                                    <input type="hidden" name="create_invite" value="true">
                                    <button type="submit" class="vmp-action-button vmp-action-button-primary">
                                        Approve & Send Invite
                                    </button>
                                </form>
                                <form hx-post="/ops/access-requests/{{ request.id }}/status" 
                                      hx-target="closest .vmp-panel" 
                                      hx-swap="outerHTML"
                                      class="inline">
                                    <input type="hidden" name="status" value="approved">
                                    <button type="submit" class="vmp-action-button vmp-action-button-ghost">
                                        Approve Only
                                    </button>
                                </form>
                                <form hx-post="/ops/access-requests/{{ request.id }}/status" 
                                      hx-target="closest .vmp-panel" 
                                      hx-swap="outerHTML"
                                      class="inline">
                                    <input type="hidden" name="status" value="rejected">
                                    <button type="submit" class="vmp-action-button vmp-action-button-ghost vmp-text-danger">
                                        Reject
                                    </button>
                                </form>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="vmp-empty">
                    <div class="font-serif text-6xl italic opacity-35">N</div>
                    <div class="vmp-empty-title">NO REQUESTS</div>
                    <div class="vmp-empty-description">
                        {% if statusFilter %}
                            No {{ statusFilter }} requests found.
                        {% else %}
                            No access requests found.
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

