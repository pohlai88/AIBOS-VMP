{% extends "layout.html" %}
{% block title %}Port Configuration â€” NexusCanon Ops{% endblock %}

{% block content %}
<div class="h-full overflow-y-auto">
    <div class="vmp-container py-8 max-w-5xl mx-auto">
        
        <header class="mb-8 border-b pb-6" style="border-color: var(--vmp-border);">
            <div class="vmp-label mb-2 opacity-70">// INFRASTRUCTURE</div>
            <h1 class="vmp-h1 leading-none mb-2">Omnichannel Ports</h1>
            <p class="vmp-body max-w-[60ch] opacity-80">
                Manage the ingress/egress bridges for Email and WhatsApp integrations.
            </p>
        </header>

        <div id="port-configuration-container"
             hx-get="/partials/port-configuration.html"
             hx-trigger="load"
             hx-target="this"
             hx-swap="innerHTML"
             class="mb-12 min-h-[200px]">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="vmp-skeleton h-64 w-full rounded-xl"></div>
                <div class="vmp-skeleton h-64 w-full rounded-xl"></div>
            </div>
        </div>

        <section>
            <div class="flex items-center justify-between mb-4">
                <h3 class="vmp-h4">Live Activity Stream</h3>
                
                <div class="vmp-panel p-1 flex items-center gap-1 rounded-lg border" style="border-color: var(--vmp-border);">
                    <button onclick="filterActivityLog(null)" 
                            class="vmp-btn vmp-btn-sm vmp-btn-ghost text-xs px-3 active-tab">
                        ALL
                    </button>
                    <button onclick="filterActivityLog('email')" 
                            class="vmp-btn vmp-btn-sm vmp-btn-ghost text-xs px-3">
                        EMAIL
                    </button>
                    <button onclick="filterActivityLog('whatsapp')" 
                            class="vmp-btn vmp-btn-sm vmp-btn-ghost text-xs px-3">
                        WHATSAPP
                    </button>
                </div>
            </div>

            <div id="port-activity-log-container"
                 hx-get="/partials/port-activity-log.html"
                 hx-trigger="load"
                 hx-target="this"
                 hx-swap="innerHTML"
                 class="min-h-[300px]">
                <div class="vmp-skeleton h-64 w-full rounded-xl"></div>
            </div>
        </section>
    </div>
</div>

<script>
    function filterActivityLog(portType) {
        const url = portType 
            ? `/partials/port-activity-log.html?port_type=${portType}`
            : '/partials/port-activity-log.html';
        htmx.ajax('GET', url, { target: '#port-activity-log-container', swap: 'innerHTML' });
        
        // Simple tab active state logic
        event.target.parentElement.querySelectorAll('button').forEach(b => b.classList.remove('bg-[var(--vmp-bg)]', 'shadow-sm'));
        event.target.classList.add('bg-[var(--vmp-bg)]', 'shadow-sm');
    }
</script>
{% endblock %}