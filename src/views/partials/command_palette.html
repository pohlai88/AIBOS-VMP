<div x-data="{ 
  open: false,
  active: 0,
  items: [
      { id: 'nav-home', label: 'Go to Console', icon: 'Home', action: () => window.location.href = '/home' },
      { id: 'nav-inbox', label: 'Go to Case Inbox', icon: 'Inbox', action: () => window.location.href = '/cases' },
      { id: 'nav-inv', label: 'Go to Invoices', icon: 'FileText', action: () => window.location.href = '/invoices' },
      { id: 'act-new', label: 'Create New Case', icon: 'Plus', action: () => htmx.ajax('GET', '/partials/modals/new-case', { target: '#modal-container' }) },
      { id: 'act-audit', label: 'Open Audit Rail', icon: 'FileText', action: () => window.dispatchEvent(new CustomEvent('audit:open', { detail: { id: '', title: 'Audit Trail', entity: '' } })) },
      { id: 'act-theme', label: 'Toggle Theme', icon: 'Moon', action: () => document.documentElement.setAttribute('data-theme', document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark') }
  ],
  init() {
      document.addEventListener('keydown', (e) => {
          if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
              e.preventDefault();
              this.open = !this.open;
              if (this.open) this.$nextTick(() => this.$refs.cmdInput.focus());
          }
          if (e.key === 'Escape') this.open = false;
      });
      
      // Listen for programmatic open event
      window.addEventListener('cmdk:open', () => {
          this.open = true;
          this.$nextTick(() => this.$refs.cmdInput?.focus());
      });
  },
  execute(index) {
      this.items[index].action();
      this.open = false;
  }
}"
x-show="open"
class="vmp-modal-overlay z-[9999]"
style="display: none;"
x-transition.opacity>

<div class="vmp-panel w-full max-w-xl shadow-2xl flex flex-col overflow-hidden relative top-[-10vh]"
   @click.outside="open = false"
   x-transition:enter="ease-out duration-200"
   x-transition:enter-start="opacity-0 scale-95"
   x-transition:enter-end="opacity-100 scale-100">
  
  <div class="flex items-center border-b p-4" style="border-color: var(--vmp-border);">
      <svg class="w-5 h-5 opacity-40 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
      <input type="text" 
             x-ref="cmdInput"
             class="vmp-input border-none bg-transparent p-0 text-lg focus:ring-0" 
             placeholder="What do you need?..."
             @keydown.arrow-down.prevent="active = (active + 1) % items.length"
             @keydown.arrow-up.prevent="active = (active - 1 + items.length) % items.length"
             @keydown.enter.prevent="execute(active)">
      <div class="vmp-tag vmp-tag-mono text-[10px] opacity-40">ESC</div>
  </div>

  <div class="max-h-[300px] overflow-y-auto p-2">
      <div class="vmp-label px-3 py-2 opacity-50 text-[10px]">SUGGESTIONS</div>
      <template x-for="(item, index) in items" :key="item.id">
          <button class="w-full flex items-center justify-between px-3 py-3 rounded-lg text-left transition-colors"
                  :class="active === index ? 'bg-[var(--vmp-border)]' : 'hover:bg-[var(--vmp-border)]'"
                  @click="execute(index)"
                  @mousemove="active = index">
              <div class="flex items-center gap-3">
                  <div class="w-8 h-8 rounded border grid place-items-center opacity-60" style="border-color: var(--vmp-border);">
                      <svg x-show="item.icon === 'Home'" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                      <svg x-show="item.icon === 'Inbox'" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>
                      <svg x-show="item.icon === 'FileText'" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                      <svg x-show="item.icon === 'Plus'" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                      <svg x-show="item.icon === 'Moon'" class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                  </div>
                  <span class="vmp-body-small" x-text="item.label"></span>
              </div>
              <span class="vmp-caption opacity-30">Jump</span>
          </button>
      </template>
  </div>
  
  <div class="px-4 py-2 border-t flex justify-between items-center" style="border-color: var(--vmp-border);">
      <div class="flex gap-4">
          <span class="vmp-caption opacity-40"><strong class="font-medium">↑↓</strong> to navigate</span>
          <span class="vmp-caption opacity-40"><strong class="font-medium">↵</strong> to select</span>
      </div>
      <div class="vmp-code-small opacity-30">VMP-OS</div>
  </div>
</div>
</div>