<!-- DN Proposal Modal/Panel -->
<div class="vmp-panel" style="padding: var(--vmp-space-4);">
  <div style="display: flex; align-items: flex-start; justify-content: space-between; gap: var(--vmp-space-3);">
    <div>
      <div class="vmp-label-kicker" style="margin-bottom: var(--vmp-space-2);">// debit note proposal</div>
      <div class="vmp-body" style="font-size: var(--vmp-font-sm); color: var(--vmp-text);">
        Issue: <span style="color: var(--vmp-subtle);">{{ issue.issue_type or 'N/A' }}</span> Â· Delta:
        <span style="color: var(--vmp-subtle);">{{ "%.2f"|format(issue.amount_delta) if issue.amount_delta else '0.00' }}</span>
      </div>
    </div>

    <button class="vmp-btn vmp-btn-ghost" 
            hx-get="/soa/recon/{{ statement.id }}"
            hx-target="#soa-workspace"
            hx-swap="innerHTML">
      Close
    </button>
  </div>

  <div style="height: 1px; background: var(--vmp-border); margin: var(--vmp-space-4) 0;"></div>

  <form
    hx-post="/api/dn/propose"
    hx-trigger="submit"
    hx-target="#soa-toast"
    hx-swap="innerHTML"
    style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--vmp-space-3);">
    <input type="hidden" name="soa_statement_id" value="{{ statement.id }}">
    <input type="hidden" name="soa_issue_id" value="{{ issue.id }}">
    <input type="hidden" name="vendor_id" value="{{ statement.vendor_id }}">

    <div>
      <div class="vmp-label-kicker" style="margin-bottom: var(--vmp-space-2);">reason</div>
      <select class="vmp-select" style="width: 100%;" name="reason_code" required>
        <option value="OVERPAYMENT">Overpayment</option>
        <option value="PRICE_VARIANCE">Price variance</option>
        <option value="WHT">Withholding tax</option>
        <option value="CLAIM">General claim</option>
      </select>
    </div>

    <div>
      <div class="vmp-label-kicker" style="margin-bottom: var(--vmp-space-2);">amount</div>
      <input class="vmp-input" style="width: 100%;" name="amount" value="{{ issue.amount_delta|abs if issue.amount_delta else '0.00' }}" required>
    </div>

    <div style="grid-column: 1 / -1;">
      <div class="vmp-label-kicker" style="margin-bottom: var(--vmp-space-2);">notes</div>
      <input class="vmp-input" style="width: 100%;" name="note" placeholder="Internal justification (audit)">
    </div>

    <div style="grid-column: 1 / -1; display: flex; gap: var(--vmp-space-2); padding-top: var(--vmp-space-2);">
      <button class="vmp-btn vmp-btn-primary" type="submit">Create Draft DN</button>
      <button
        class="vmp-btn vmp-btn-ghost"
        type="button"
        hx-post="/api/soa/{{ statement.id }}/recompute"
        hx-target="#soa-toast"
        hx-swap="innerHTML">
        Recompute after draft
      </button>
    </div>
  </form>
</div>

