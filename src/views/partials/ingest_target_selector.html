<div class="vmp-panel p-5 border shadow-sm mb-8" style="border-color: var(--vmp-border);">
    
    <div class="flex items-start gap-5">
        <div class="w-12 h-12 rounded-xl bg-[var(--vmp-bg)] border grid place-items-center shrink-0 text-[var(--vmp-brand)]" style="border-color: var(--vmp-border);">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path></svg>
        </div>

        <div class="flex-1">
            <h3 class="vmp-h5 mb-1">Target Entity</h3>
            <p class="vmp-caption opacity-60 mb-4">Select the legal entity for this data ingestion batch.</p>
            
            <form class="flex flex-col md:flex-row gap-4 items-start">
                
                <div class="flex-1 w-full">
                    <label class="vmp-label mb-1 opacity-70">Company / Entity</label>
                    <select name="company_id" 
                            class="vmp-select w-full" 
                            hx-post="/ops/ingest/set-target" 
                            hx-trigger="change"
                            hx-swap="none">
                        <option value="" disabled selected>Select Target Entity...</option>
                        
                        {% if orgTree and orgTree.groups %}
                            {% for group in orgTree.groups %}
                                <optgroup label="{{ group.name }}">
                                    {% for company in group.companies %}
                                    <option value="{{ company.id }}" {{ 'selected' if currentTarget == company.id }}>
                                        {{ company.name }} ({{ company.code or '---' }})
                                    </option>
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                        {% endif %}

                        {% if orgTree.ungroupedCompanies %}
                            <optgroup label="Ungrouped">
                                {% for company in orgTree.ungroupedCompanies %}
                                <option value="{{ company.id }}" {{ 'selected' if currentTarget == company.id }}>
                                    {{ company.name }} ({{ company.code or '---' }})
                                </option>
                                {% endfor %}
                            </optgroup>
                        {% endif %}
                    </select>
                </div>
                
                <div class="md:mt-6">
                    <div class="flex items-center gap-2 px-3 py-2 rounded border bg-[var(--vmp-bg)]" style="border-color: var(--vmp-border);">
                        <div class="w-2 h-2 rounded-full {{ 'bg-[var(--vmp-ok)]' if currentTarget else 'bg-[var(--vmp-warn)] animate-pulse' }}"></div>
                        <span class="vmp-code-small opacity-60">{{ 'READY' if currentTarget else 'NO TARGET' }}</span>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>