<!-- Invoice List Partial -->
<div class="flex flex-col h-full" data-list-type="invoices">
    {% if error %}
    <div class="p-3 m-4 rounded-lg border vmp-border-warn vmp-bg-warn vmp-opacity-30">
        <div class="vmp-caption vmp-text-warn">{{ error }}</div>
    </div>
    {% endif %}

    <!-- Bulk Actions Bar (Sprint 11.1) -->
    {% include "partials/bulk_actions_bar.html" %}

    <!-- Filters -->
    <div class="sticky top-0 z-10 vmp-component-card-header backdrop-blur-md flex gap-2 overflow-x-auto py-3 mb-4">
        <form hx-get="/partials/invoice-list.html" hx-target="#invoice-list-container" hx-swap="innerHTML"
            class="flex gap-2 items-center">
            <input type="text" name="search" placeholder="Search invoice #..." class="vmp-form-input text-sm"
                value="{{ request.query.search or '' }}">
            <select name="status" class="vmp-form-input text-sm">
                <option value="">All Status</option>
                <option value="pending" {% if request.query.status=='pending' %}selected{% endif %}>Pending</option>
                <option value="matched" {% if request.query.status=='matched' %}selected{% endif %}>Matched</option>
                <option value="paid" {% if request.query.status=='paid' %}selected{% endif %}>Paid</option>
                <option value="disputed" {% if request.query.status=='disputed' %}selected{% endif %}>Disputed</option>
            </select>
            <button type="submit" class="vmp-btn-outline text-sm">Filter</button>
        </form>
    </div>

    <!-- Invoice List Table (Finance Persona - Desktop Polish) -->
    <div class="overflow-x-auto">
        <table class="vmp-table w-full">
            <thead>
                <tr>
                    <th style="width: 40px;">
                        <input type="checkbox" class="vmp-checkbox" id="select-all-invoices" 
                               @change="document.dispatchEvent(new CustomEvent('bulk-select-all'))">
                    </th>
                    <th>Invoice #</th>
                    <th>Date</th>
                    <th>Company</th>
                    <th style="text-align: right;">Amount</th>
                    <th>Status</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if invoices and invoices|length > 0 %}
                {% for invoice in invoices %}
                <tr>
                    <td>
                        <input 
                            type="checkbox" 
                            class="vmp-checkbox"
                            data-bulk-item-id="{{ invoice.id }}"
                            @change="document.dispatchEvent(new CustomEvent('bulk-toggle', { detail: { id: '{{ invoice.id }}' } }))">
                    </td>
                    <td class="font-medium">
                        {{ invoice.invoice_num }}
                    </td>
                    <td>
                        {{ invoice.invoice_date | date('%b %d, %Y') if invoice.invoice_date else 'â€”' }}
                    </td>
                    <td>
                        {{ invoice.vmp_companies.name if invoice.vmp_companies else 'N/A' }}
                    </td>
                    <td
                        style="text-align: right; font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;">
                        {{ "%.2f"|format(invoice.amount if invoice.amount else 0) }} {{ invoice.currency_code or 'USD'
                        }}
                    </td>
                    <td>
                        {% set st = (invoice.status or 'pending') | lower %}
                        {% if st == 'paid' %}
                        <span class="vmp-badge vmp-badge-ok">PAID</span>
                        {% elif st == 'pending' %}
                        <span class="vmp-badge vmp-badge-warn">PENDING</span>
                        {% elif st == 'matched' %}
                        <span class="vmp-badge">MATCHED</span>
                        {% elif st == 'disputed' or st == 'blocked' %}
                        <span class="vmp-badge vmp-badge-danger"
                            style="animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;">
                            {{ st | upper }}
                        </span>
                        {% else %}
                        <span class="vmp-badge">{{ st | upper }}</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <a href="/invoices/{{ invoice.id }}" class="vmp-btn vmp-btn-ghost"
                            style="font-size: var(--vmp-font-sm); padding: var(--vmp-space-1) var(--vmp-space-3);">
                            View
                        </a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: var(--vmp-space-8); color: var(--vmp-subtle);">
                        No invoices found matching your criteria.
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>