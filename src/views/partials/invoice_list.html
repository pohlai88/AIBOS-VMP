<!-- Invoice List Partial -->
<div class="flex flex-col h-full" data-list-type="invoices">
    {% if error %}
    <div class="p-3 m-4 rounded-lg border vmp-border-warn vmp-bg-warn vmp-opacity-30">
        <div class="vmp-caption vmp-text-warn">{{ error }}</div>
    </div>
    {% endif %}

    <!-- Bulk Actions Bar (Sprint 11.1) -->
    {% include "partials/bulk_actions_bar.html" %}

    <!-- Filters -->
    <div class="sticky top-0 z-10 vmp-component-card-header backdrop-blur-md flex gap-2 overflow-x-auto py-3 mb-4">
        <form hx-get="/partials/invoice-list.html" hx-target="#invoice-list-container" hx-swap="innerHTML"
            class="flex flex-col md:flex-row gap-2 items-stretch md:items-center w-full">
            <input type="text" name="search" placeholder="Search invoice #..." class="vmp-form-input text-sm flex-1"
                value="{{ request.query.search or '' }}">
            <select name="status" class="vmp-form-input text-sm flex-1 md:flex-none">
                <option value="">All Status</option>
                <option value="pending" {% if request.query.status=='pending' %}selected{% endif %}>Pending</option>
                <option value="matched" {% if request.query.status=='matched' %}selected{% endif %}>Matched</option>
                <option value="paid" {% if request.query.status=='paid' %}selected{% endif %}>Paid</option>
                <option value="disputed" {% if request.query.status=='disputed' %}selected{% endif %}>Disputed</option>
            </select>
            <button type="submit" class="vmp-btn-outline text-sm w-full md:w-auto">Filter</button>
        </form>
    </div>

    <!-- Invoice List Table (Finance Persona - Desktop Polish) -->
    <div class="overflow-x-auto">
        <table class="vmp-table w-full">
            <thead>
                <tr>
                    <th style="width: 40px;">
                        <input type="checkbox" 
                               class="vmp-checkbox" 
                               id="select-all-invoices" 
                               @change="document.dispatchEvent(new CustomEvent('bulk-select-all'))"
                               aria-label="Select all invoices">
                    </th>
                    <th>Invoice #</th>
                    <th>Date</th>
                    <th>Company</th>
                    <th style="text-align: right;">Amount</th>
                    <th>Status</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% if invoices and invoices|length > 0 %}
                {% for invoice in invoices %}
                <tr>
                    <td>
                        <input 
                            type="checkbox" 
                            class="vmp-checkbox"
                            data-bulk-item-id="{{ invoice.id }}"
                            @change="document.dispatchEvent(new CustomEvent('bulk-toggle', { detail: { id: '{{ invoice.id }}' } }))">
                    </td>
                    <td class="font-medium">
                        {{ invoice.invoice_num }}
                    </td>
                    <td>
                        {{ invoice.invoice_date | date('%b %d, %Y') if invoice.invoice_date else 'â€”' }}
                    </td>
                    <td>
                        {{ invoice.vmp_companies.name if invoice.vmp_companies else 'N/A' }}
                    </td>
                    <td
                        style="text-align: right; font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', monospace;">
                        {{ "%.2f"|format(invoice.amount if invoice.amount else 0) }} {{ invoice.currency_code or 'USD'
                        }}
                    </td>
                    <td>
                        {% set st = (invoice.status or 'pending') | lower %}
                        {% if st == 'paid' %}
                        <span class="vmp-badge vmp-badge-ok" role="status" aria-label="Invoice status: Paid">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                            PAID
                        </span>
                        {% elif st == 'pending' %}
                        <span class="vmp-badge vmp-badge-warn" role="status" aria-label="Invoice status: Pending">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            PENDING
                        </span>
                        {% elif st == 'matched' %}
                        <span class="vmp-badge" role="status" aria-label="Invoice status: Matched">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                            </svg>
                            MATCHED
                        </span>
                        {% elif st == 'disputed' or st == 'blocked' %}
                        <span class="vmp-badge vmp-badge-danger"
                            style="animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;"
                            role="status" aria-label="Invoice status: {{ st | upper }}">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                            </svg>
                            {{ st | upper }}
                        </span>
                        {% else %}
                        <span class="vmp-badge" role="status" aria-label="Invoice status: {{ st | upper }}">{{ st | upper }}</span>
                        {% endif %}
                    </td>
                    <td style="text-align: right;">
                        <a href="/invoices/{{ invoice.id }}" class="vmp-btn vmp-btn-ghost"
                            style="font-size: var(--vmp-font-sm); padding: var(--vmp-space-1) var(--vmp-space-3);"
                            aria-label="View invoice {{ invoice.invoice_num or invoice.id }}">
                            View
                        </a>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr>
                    <td colspan="7" style="text-align: center; padding: var(--vmp-space-8); color: var(--vmp-subtle);">
                        No invoices found matching your criteria.
                    </td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>