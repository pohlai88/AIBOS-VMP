<div class="flex flex-col h-full" data-list-type="payments">
    
    {% if error %}
    <div class="vmp-alert vmp-alert-warn mb-4">
        <div class="vmp-caption">{{ error }}</div>
    </div>
    {% endif %}

    {% include "partials/bulk_actions_bar.html" %}

    <div class="vmp-panel p-4 border mb-6" style="border-color: var(--vmp-border);">
        <form hx-get="/partials/payment-list.html" 
              hx-target="#payment-list-container" 
              hx-swap="innerHTML"
              class="flex flex-wrap gap-3 items-center">
            
            <div class="relative flex-1 min-w-[200px]">
                <svg class="absolute left-3 top-2.5 w-4 h-4 opacity-40" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                <input type="text" name="payment_ref" placeholder="Payment Ref..." class="vmp-input pl-9 h-10 text-sm" value="{{ query.payment_ref or '' }}">
            </div>
            
            <input type="text" name="invoice_num" placeholder="Invoice #..." class="vmp-input h-10 text-sm w-32" value="{{ query.invoice_num or '' }}">
            
            <div class="flex items-center gap-2 border-l pl-3" style="border-color: var(--vmp-border);">
                <input type="date" name="date_from" class="vmp-input h-10 text-sm w-auto" value="{{ query.date_from or '' }}">
                <span class="opacity-30">-</span>
                <input type="date" name="date_to" class="vmp-input h-10 text-sm w-auto" value="{{ query.date_to or '' }}">
            </div>

            <button type="submit" class="vmp-btn vmp-btn-outline vmp-btn-sm h-10">Filter</button>
        </form>
    </div>

    <div class="space-y-2">
        {% if payments and payments|length > 0 %}
            {% for payment in payments %}
            <div class="vmp-panel border transition-colors hover:bg-[var(--vmp-bg)] group relative overflow-hidden"
                 style="border-color: var(--vmp-border);">
                
                <div class="absolute left-0 top-0 bottom-0 w-[3px] bg-[var(--vmp-brand)] opacity-0 group-hover:opacity-100 transition-opacity"></div>

                <div class="flex items-center p-4 gap-4">
                    <div class="shrink-0" onclick="event.stopPropagation()">
                        <input type="checkbox" 
                               class="vmp-checkbox"
                               data-bulk-item-id="{{ payment.id }}"
                               @change="document.dispatchEvent(new CustomEvent('bulk-toggle', { detail: { id: '{{ payment.id }}' } }))">
                    </div>

                    <a href="/payments/{{ payment.id }}" class="flex-1 flex items-center gap-6 min-w-0">
                        
                        <div class="shrink-0">
                            {% if payment.remittance_url %}
                                <div class="w-2 h-2 rounded-full bg-[var(--vmp-ok)]"></div>
                            {% else %}
                                <div class="w-2 h-2 rounded-full border border-[var(--vmp-border)]"></div>
                            {% endif %}
                        </div>

                        <div class="min-w-0 w-48">
                            <div class="flex items-center gap-2">
                                <span class="vmp-code-small opacity-60">#{{ payment.payment_ref }}</span>
                            </div>
                            <div class="vmp-caption opacity-40 truncate">
                                {{ payment.vmp_companies.name if payment.vmp_companies else 'Unknown Company' }}
                            </div>
                        </div>

                        <div class="w-32 text-right">
                            <div class="vmp-code-small text-[var(--vmp-text)]">
                                {{ payment.currency_code or 'USD' }} {{ "%.2f"|format(payment.amount) if payment.amount else '0.00' }}
                            </div>
                        </div>

                        <div class="w-32 text-right">
                            <div class="vmp-caption opacity-50">
                                {{ payment.payment_date | date('%b %d, %Y') if payment.payment_date else 'â€”' }}
                            </div>
                        </div>

                        <div class="flex-1 text-right flex justify-end items-center gap-3">
                            {% if payment.remittance_url %}
                                <span class="vmp-tag text-[9px] py-0 px-1 opacity-60">REMITTANCE</span>
                            {% endif %}
                            <span class="vmp-code-small opacity-30 text-[10px]">
                                {{ (payment.source_system or 'manual') | upper }}
                            </span>
                        </div>
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="vmp-empty py-12">
                <div class="font-serif text-4xl italic opacity-20 mb-2">P</div>
                <div class="vmp-empty-title">NO PAYMENTS</div>
                <div class="vmp-empty-description">No payment history matches your criteria.</div>
            </div>
        {% endif %}
    </div>
</div>