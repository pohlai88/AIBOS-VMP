<!-- Profile Form Partial -->
<div class="vmp-panel p-6 border vmp-border-color">
    {% if error %}
    <div class="p-4 mb-4 rounded-lg border vmp-border-warn vmp-bg-warn vmp-opacity-30">
        <div class="vmp-label vmp-text-warn">{{ error }}</div>
    </div>
    {% endif %}

    {% if success %}
    <div class="p-4 mb-4 rounded-lg border vmp-border-ok vmp-bg-ok vmp-opacity-30">
        <div class="vmp-label vmp-text-ok">{{ success }}</div>
    </div>
    {% endif %}

    <div class="vmp-label-kicker vmp-label-kicker-strong mb-4">VENDOR PROFILE</div>

    {% if vendorProfile and vendorProfile.vendor %}
    <div class="space-y-6">
        <!-- Vendor Master Data -->
        <div class="grid grid-cols-2 gap-4">
            <div>
                <div class="vmp-label-kicker mb-1">Vendor Name</div>
                <div class="vmp-body">{{ vendorProfile.vendor.name }}</div>
            </div>
            <div>
                <div class="vmp-label-kicker mb-1">Status</div>
                <div class="vmp-body">
                    <span class="vmp-tag vmp-tag-mono text-xs">
                        {{ (vendorProfile.vendor.status or 'invited') | upper }}
                    </span>
                </div>
            </div>
            <div>
                <div class="vmp-label-kicker mb-1">Tenant</div>
                <div class="vmp-body">
                    {{ vendorProfile.vendor.vmp_tenants.name if vendorProfile.vendor.vmp_tenants else '—' }}
                </div>
            </div>
            <div>
                <div class="vmp-label-kicker mb-1">Created</div>
                <div class="vmp-body">
                    {{ vendorProfile.vendor.created_at | date('%b %d, %Y') if vendorProfile.vendor.created_at else '—'
                    }}
                </div>
            </div>
        </div>

        <!-- Company Links -->
        {% if vendorProfile.companyLinks and vendorProfile.companyLinks|length > 0 %}
        <div class="border-t vmp-border-color pt-4">
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">LINKED COMPANIES</div>
            <div class="space-y-2">
                {% for link in vendorProfile.companyLinks %}
                <div class="p-3 rounded-lg border vmp-border-color vmp-bg-panel">
                    <div class="vmp-body-small font-medium mb-1">
                        {{ link.vmp_companies.name if link.vmp_companies else 'Unknown Company' }}
                    </div>
                    {% if link.vmp_companies and link.vmp_companies.legal_name %}
                    <div class="vmp-caption vmp-muted">
                        {{ link.vmp_companies.legal_name }}
                    </div>
                    {% endif %}
                    {% if link.vmp_companies and link.vmp_companies.country_code %}
                    <div class="vmp-caption vmp-muted mt-1">
                        {{ link.vmp_companies.country_code }}
                        {% if link.vmp_companies.currency_code %}
                        • {{ link.vmp_companies.currency_code }}
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Vendor Users -->
        {% if vendorProfile.users and vendorProfile.users|length > 0 %}
        <div class="border-t vmp-border-color pt-4">
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">USER ACCOUNTS</div>
            <div class="space-y-2">
                {% for user in vendorProfile.users %}
                <div class="p-3 rounded-lg border vmp-border-color vmp-bg-panel">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="vmp-body-small font-medium">
                                {{ user.display_name or user.email }}
                            </div>
                            <div class="vmp-caption vmp-muted">{{ user.email }}</div>
                        </div>
                        <span class="vmp-tag vmp-tag-mono text-xs">
                            {{ 'ACTIVE' if user.is_active else 'INACTIVE' }}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Contact Information (Editable - Low Risk) -->
        <div class="border-t vmp-border-color pt-4">
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">CONTACT INFORMATION</div>
            <div class="vmp-body vmp-muted mb-4 text-sm">
                You can update your contact information directly. Changes are saved immediately.
            </div>
            <form hx-post="/profile/contact" hx-target="#profile-form-container" hx-swap="innerHTML"
                hx-indicator="#contact-update-loading" class="space-y-4">
                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="vmp-label-kicker mb-2 block">Address</label>
                        <textarea name="address" rows="3" class="vmp-form-input w-full"
                            placeholder="Enter your business address">{{ vendorProfile.vendor.address or '' }}</textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Phone</label>
                            <input type="text" name="phone" class="vmp-form-input w-full"
                                placeholder="+1 (555) 123-4567" value="{{ vendorProfile.vendor.phone or '' }}">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Website</label>
                            <input type="url" name="website" class="vmp-form-input w-full"
                                placeholder="https://example.com" value="{{ vendorProfile.vendor.website or '' }}">
                        </div>
                    </div>
                </div>
                <div class="flex justify-end">
                    <button type="submit" class="vmp-btn-primary">
                        Save Contact Information
                    </button>
                </div>
                <div id="contact-update-loading" class="htmx-indicator">
                    <div class="vmp-label-kicker animate-pulse opacity-60">Saving...</div>
                </div>
            </form>
        </div>

        <!-- Compliance Information (Read-Only) -->
        <div class="border-t vmp-border-color pt-4">
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">COMPLIANCE INFORMATION</div>
            <div class="vmp-body vmp-muted mb-4 text-sm">
                Compliance information is managed by your organization. Contact support to request changes.
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <div class="vmp-label-kicker mb-1">Tax ID</div>
                    <div class="vmp-body">
                        {{ vendorProfile.vendor.tax_id or '—' }}
                    </div>
                </div>
                <div>
                    <div class="vmp-label-kicker mb-1">Registration Number</div>
                    <div class="vmp-body">
                        {{ vendorProfile.vendor.reg_number or '—' }}
                    </div>
                </div>
            </div>
        </div>

        <!-- Bank Details (Read-Only Display + Change Request) -->
        <div class="border-t vmp-border-color pt-4">
            <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">BANK DETAILS</div>
            <div class="vmp-body vmp-muted mb-4 text-sm">
                Bank details are protected. To change them, submit a request below. A Bank Letter will be required as
                evidence.
            </div>

            <!-- Current Bank Details (Read-Only Display) -->
            {% if vendorProfile.vendor.bank_name or vendorProfile.vendor.account_number or
            vendorProfile.vendor.swift_code %}
            <div class="p-4 mb-4 rounded-lg border vmp-border-color vmp-bg-panel">
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <div class="vmp-label-kicker mb-1">Bank Name</div>
                        <div class="vmp-body">{{ vendorProfile.vendor.bank_name or '—' }}</div>
                    </div>
                    <div>
                        <div class="vmp-label-kicker mb-1">Account Holder</div>
                        <div class="vmp-body">{{ vendorProfile.vendor.account_holder_name or '—' }}</div>
                    </div>
                    <div>
                        <div class="vmp-label-kicker mb-1">Account Number</div>
                        <div class="vmp-body font-mono text-sm">
                            {% if vendorProfile.vendor.account_number %}
                            ••••{{ vendorProfile.vendor.account_number[-4:] if
                            vendorProfile.vendor.account_number|length > 4 else '••••' }}
                            {% else %}
                            —
                            {% endif %}
                        </div>
                    </div>
                    <div>
                        <div class="vmp-label-kicker mb-1">SWIFT Code</div>
                        <div class="vmp-body">{{ vendorProfile.vendor.swift_code or '—' }}</div>
                    </div>
                    {% if vendorProfile.vendor.bank_address %}
                    <div class="col-span-2">
                        <div class="vmp-label-kicker mb-1">Bank Address</div>
                        <div class="vmp-body">{{ vendorProfile.vendor.bank_address }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="p-4 mb-4 rounded-lg border vmp-border-color vmp-bg-panel">
                <div class="vmp-body vmp-muted text-center">No bank details on file</div>
            </div>
            {% endif %}

            <!-- Bank Details Change -->
            <div class="border-t vmp-border-color pt-4">
                <div class="vmp-label-kicker vmp-label-kicker-strong mb-3">BANK DETAILS</div>
                <div class="vmp-body vmp-muted mb-4">
                    To change your bank details, please submit a request. A Bank Letter will be required as evidence.
                </div>
                <form hx-post="/profile/bank-details" hx-target="#bank-details-result" hx-swap="innerHTML"
                    class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Account Name</label>
                            <input type="text" name="account_name" required class="vmp-form-input w-full">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Account Number</label>
                            <input type="text" name="account_number" required class="vmp-form-input w-full">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Bank Name</label>
                            <input type="text" name="bank_name" required class="vmp-form-input w-full">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">SWIFT Code</label>
                            <input type="text" name="swift_code" required class="vmp-form-input w-full">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Branch Address (Optional)</label>
                            <input type="text" name="branch_address" class="vmp-form-input w-full">
                        </div>
                        <div>
                            <label class="vmp-label-kicker mb-2 block">Currency (Optional)</label>
                            <input type="text" name="currency" class="vmp-form-input w-full" placeholder="USD">
                        </div>
                    </div>
                    <div class="flex justify-end">
                        <button type="submit" class="vmp-btn-primary">
                            Request Bank Details Change
                        </button>
                    </div>
                    <div id="bank-details-result"></div>
                </form>
            </div>
        </div>
        {% else %}
        <div class="vmp-body vmp-muted text-center py-8">
            {% if error %}
            {{ error }}
            {% else %}
            No profile data available.
            {% endif %}
        </div>
        {% endif %}
    </div>