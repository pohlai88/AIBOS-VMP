<!-- SLA Trend Charts Partial (Chart.js) -->
<div class="vmp-panel p-6 border vmp-border-color">
    <div class="vmp-label-kicker vmp-label-kicker-strong mb-4">SLA TRENDS</div>

    {% if slaMetrics and slaMetrics.trends and slaMetrics.trends|length > 0 %}
    {% set trends = slaMetrics.trends %}
    <div class="space-y-6">
        <!-- Compliance Rate Trend Chart -->
        <div>
            <div class="vmp-label mb-2">Compliance Rate Over Time</div>
            <canvas id="complianceRateChart" height="80"></canvas>
        </div>

        <!-- Average Response Time Trend Chart -->
        <div class="pt-6 border-t vmp-border-color">
            <div class="vmp-label mb-2">Average Response Time Over Time</div>
            <canvas id="responseTimeChart" height="80"></canvas>
        </div>
    </div>
    {% else %}
    <div class="vmp-body vmp-muted text-center py-8">
        No trend data available for the selected period.
    </div>
    {% endif %}
</div>

{% if slaMetrics and slaMetrics.trends and slaMetrics.trends|length > 0 %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
(function() {
    const trends = {{ slaMetrics.trends | tojson }};
    const dates = trends.map(t => t.date);
    
    // Compliance Rate Chart
    const complianceCtx = document.getElementById('complianceRateChart');
    if (complianceCtx) {
        new Chart(complianceCtx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Compliance Rate (%)',
                    data: trends.map(t => t.complianceRate),
                    borderColor: 'rgb(34, 197, 94)',
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return 'Compliance: ' + context.parsed.y.toFixed(1) + '%';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return value + '%';
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
    }
    
    // Response Time Chart
    const responseCtx = document.getElementById('responseTimeChart');
    if (responseCtx) {
        new Chart(responseCtx, {
            type: 'bar',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Average Response Time (hours)',
                    data: trends.map(t => t.averageResponseTime),
                    backgroundColor: trends.map(t => {
                        if (t.averageResponseTime <= 2) return 'rgba(34, 197, 94, 0.7)';
                        if (t.averageResponseTime <= 4) return 'rgba(234, 179, 8, 0.7)';
                        return 'rgba(239, 68, 68, 0.7)';
                    }),
                    borderColor: trends.map(t => {
                        if (t.averageResponseTime <= 2) return 'rgb(34, 197, 94)';
                        if (t.averageResponseTime <= 4) return 'rgb(234, 179, 8)';
                        return 'rgb(239, 68, 68)';
                    }),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function(context) {
                                return 'Response Time: ' + context.parsed.y.toFixed(1) + ' hours';
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + 'h';
                            }
                        }
                    },
                    x: {
                        ticks: {
                            maxRotation: 45,
                            minRotation: 45
                        }
                    }
                }
            }
        });
    }
})();
</script>
{% endif %}

